<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tajniak</title>

<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}

input[type="number"], select, textarea {
    width: 90%;
    font-size: 16px;
    padding: 6px;
}

button {
    font-size: 18px;
    padding: 10px 25px;
    margin-top: 15px;
    cursor: pointer;
}

#haslo {
    font-size: 28px;
    margin-top: 20px;
}

/* Kategorie */
.kategorie {
    margin-top: 40px;
}

.kategorie label {
    display: inline-block;
    margin: 8px;
}

.kategorie input {
    display: none;
}

.kategorie span {
    display: inline-block;
    padding: 12px 20px;
    border-radius: 8px;
    background-color: #b6f0b6;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
}

.kategorie span:hover {
    background-color: #8fdd8f;
}

.kategorie input:checked + span {
    background-color: #4caf50;
    color: white;
}

/* Edytor */
#editor {
    display: none;
    margin-top: 30px;
    border-top: 2px dashed #ccc;
    padding-top: 20px;
}
</style>
</head>
<body>

<h2>Tajniak</h2>

<div id="start">
    <p>Ilość graczy:</p>
    <input type="number" id="gracze" value="5" min="3">

    <p>Tryb impostorów:</p>
    <select id="trybImpostora">
        <option value="1">1 impostor</option>
        <option value="2">2 impostorów</option>
        <option value="losowo" selected>Losowo</option>
    </select>

    <br>
    <button onclick="start()">Graj</button>

    <div class="kategorie" id="kategorieBox"></div>

    <br>
    <button onclick="toggleEditor()">⚙ Edytuj kategorie</button>

    <div id="editor">
        <p><strong>Edytuj kategorie (format: Kategoria: słowo, słowo)</strong></p>
        <textarea id="editorText" rows="8"></textarea><br>
        <button onclick="zapiszKategorie()">Zapisz</button>
    </div>
</div>

<div id="gra" style="display:none;">
    <h3 id="info"></h3>
    <button onclick="pokaz()">Pokaż hasło</button>
    <div id="haslo"></div>
    <br>
    <button onclick="dalej()" style="display:none;">Podaj telefon dalej</button>
</div>

<script>
let liczbaGraczy;
let aktualny = 0;
let impostorzy = [];
let slowo;
let chaos = false;

/* ===== KATEGORIE ===== */
let kategorie = JSON.parse(localStorage.getItem("kategorie")) || {
    Zwierzęta: ["kot", "pies", "lew"],
    Miejsca: ["las", "kino", "plaża"],
    Zawody: ["lekarz", "kucharz"],
    Gry: ["Minecraft", "GTA"],
    Filmy: ["Matrix", "Titanic"]
};

function renderKategorie() {
    const box = document.getElementById("kategorieBox");
    box.innerHTML = "<p><strong>Wybierz kategorie:</strong></p>";

    Object.keys(kategorie).forEach((kat, i) => {
        const id = "kat_" + i;
        box.innerHTML += `
            <label>
                <input type="checkbox" class="kat" value="${kat}" checked>
                <span>${kat}</span>
            </label>
        `;
    });
}

renderKategorie();

/* ===== EDYTOR ===== */
function toggleEditor() {
    const ed = document.getElementById("editor");
    ed.style.display = ed.style.display === "none" ? "block" : "none";

    let text = "";
    for (let k in kategorie) {
        text += `${k}: ${kategorie[k].join(", ")}\n`;
    }
    document.getElementById("editorText").value = text;
}

function zapiszKategorie() {
    const linie = document.getElementById("editorText").value.split("\n");
    let nowe = {};

    linie.forEach(l => {
        if (!l.includes(":")) return;
        const [kat, slowa] = l.split(":");
        const lista = slowa.split(",").map(s => s.trim()).filter(Boolean);
        if (lista.length > 0) nowe[kat.trim()] = lista;
    });

    kategorie = nowe;
    localStorage.setItem("kategorie", JSON.stringify(kategorie));
    renderKategorie();
    alert("Kategorie zapisane!");
}

/* ===== GRA ===== */
function start() {
    liczbaGraczy = parseInt(document.getElementById("gracze").value);
    const tryb = document.getElementById("trybImpostora").value;

    const zaznaczone = [...document.querySelectorAll(".kat:checked")].map(e => e.value);
    if (zaznaczone.length === 0) {
        alert("Wybierz przynajmniej jedną kategorię!");
        return;
    }

    let lista = [];
    zaznaczone.forEach(k => lista = lista.concat(kategorie[k]));
    slowo = lista[Math.floor(Math.random() * lista.length)];

    chaos = false;
    impostorzy = [];

    let ilosc;
    if (tryb === "losowo") {
        const r = Math.random();
        if (r < 0.45) ilosc = 1;
        else if (r < 0.9) ilosc = 2;
        else {
            chaos = true;
            ilosc = liczbaGraczy;
        }
    } else ilosc = parseInt(tryb);

    while (impostorzy.length < ilosc) {
        const i = Math.floor(Math.random() * liczbaGraczy);
        if (!impostorzy.includes(i)) impostorzy.push(i);
    }

    aktualny = 0;
    document.getElementById("start").style.display = "none";
    document.getElementById("gra").style.display = "block";
    pokazInfo();
}

function pokazInfo() {
    document.getElementById("info").innerText = "Gracz " + (aktualny + 1);
    document.getElementById("haslo").innerText = "";
    document.querySelector("button[onclick='dalej()']").style.display = "none";
}

function pokaz() {
    document.getElementById("haslo").innerText =
        (chaos || impostorzy.includes(aktualny)) ? "❌ BRAK HASŁA" : slowo;

    document.querySelector("button[onclick='dalej()']").style.display = "inline";
}

function dalej() {
    aktualny++;
    if (aktualny >= liczbaGraczy) location.reload();
    else pokazInfo();
}
</script>

</body>
</html>
