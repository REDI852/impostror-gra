<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tajniak</title>

<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}

input[type="number"], select {
    width: 90%;
    font-size: 16px;
    padding: 5px;
}

button {
    font-size: 18px;
    padding: 10px 25px;
    margin-top: 15px;
    cursor: pointer;
}

#haslo {
    font-size: 28px;
    margin-top: 20px;
}

.kategorie {
    margin-top: 40px;
}

.kategorie label {
    display: inline-block;
    margin: 8px;
}

.kategorie input {
    display: none;
}

.kategorie span {
    display: inline-block;
    padding: 12px 20px;
    border-radius: 8px;
    background-color: #b6f0b6;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
}

.kategorie span:hover {
    background-color: #8fdd8f;
}

.kategorie input:checked + span {
    background-color: #4caf50;
    color: white;
}
</style>
</head>
<body>

<h2>Tajniak</h2>

<div id="start">
    <p>Ilość graczy:</p>
    <input type="number" id="gracze" min="3">

    <p>Tryb impostorów:</p>
    <select id="trybImpostora">
        <option value="1">1 impostor</option>
        <option value="2">2 impostorów</option>
        <option value="losowo">Losowo</option>
    </select>

    <br>
    <button onclick="start()">Graj</button>

    <div class="kategorie">
        <p><strong>Wybierz kategorie:</strong></p>
        <label><input type="checkbox" class="kat" value="mikolow"><span>mikolow</span></label>
        <label><input type="checkbox" class="kat" value="marki"><span>marki</span></label>
        <label><input type="checkbox" class="kat" value="miejsca"><span>Miejsca</span></label>
        <label><input type="checkbox" class="kat" value="zawody"><span>Zawody</span></label>
        <label><input type="checkbox" class="kat" value="filmy"><span>Filmy</span></label>
    </div>
</div>

<div id="gra" style="display:none;">
    <h3 id="info"></h3>
    <button onclick="pokaz()">Pokaż hasło</button>
    <div id="haslo"></div>
    <br>
    <button onclick="dalej()" style="display:none;">Podaj telefon dalej</button>
</div>

<script>
let liczbaGraczy;
let aktualny = 0;
let impostorzy = [];
let slowo;
let chaos = false;

const kategorie = {
    mikolow: ["rynek", "trąbka", "dworzec", "silver", "fresh"],
    marki: ["apple", "ferrari", "orbit", "Axe", "dyson", "zelmer", "level up",],
    miejsca: ["istebna", "bielsko", "centrum przesiadkowe (dom gazdy) ", "działka", "boisko paniowy <!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tajniak</title>

<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}

input[type="number"], select {
    width: 90%;
    font-size: 16px;
    padding: 5px;
}

button {
    font-size: 18px;
    padding: 10px 25px;
    margin-top: 15px;
    cursor: pointer;
}

#haslo {
    font-size: 28px;
    margin-top: 20px;
}

.kategorie {
    margin-top: 40px;
}

.kategorie label {
    display: inline-block;
    margin: 8px;
}

.kategorie input {
    display: none;
}

.kategorie span {
    display: inline-block;
    padding: 12px 20px;
    border-radius: 8px;
    background-color: #b6f0b6;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
}

.kategorie span:hover {
    background-color: #8fdd8f;
}

.kategorie input:checked + span {
    background-color: #4caf50;
    color: white;
}
</style>
</head>
<body>

<h2>Tajniak</h2>

<div id="start">
    <p>Ilość graczy:</p>
    <input type="number" id="gracze" min="3">

    <p>Tryb impostorów:</p>
    <select id="trybImpostora">
        <option value="1">1 impostor</option>
        <option value="2">2 impostorów</option>
        <option value="losowo">Losowo</option>
    </select>

    <br>
    <button onclick="start()">Graj</button>

    <div class="kategorie">
        <p><strong>Wybierz kategorie:</strong></p>
        <label><input type="checkbox" class="kat" value="Mikołów"><span>Mikołów</span></label>
        <label><input type="checkbox" class="kat" value="Marki"><span>Marki</span></label>
        <label><input type="checkbox" class="kat" value="miejsca"><span>Miejsca</span></label>
        <label><input type="checkbox" class="kat" value="swieta"><span>swieta</span></label>
        <label><input type="checkbox" class="kat" value="filmy"><span>Filmy</span></label>
    </div>
</div>

<div id="gra" style="display:none;">
    <h3 id="info"></h3>
    <button onclick="pokaz()">Pokaż hasło</button>
    <div id="haslo"></div>
    <br>
    <button onclick="dalej()" style="display:none;">Podaj telefon dalej</button>
</div>

<script>
let liczbaGraczy;
let aktualny = 0;
let impostorzy = [];
let slowo;
let chaos = false;

const kategorie = {
    Mikołów: ["rynek", "trąbka", "dworzec", "silver", "fresh", "szkoła 1","szkoła 3"],
    Marki: ["apple", "ferrari", "orbit", "Axe", "dyson", "zelmer", "level up", "simens", "bmw", "tymbark", ],
    miejsca: ["działka", "bielsko", "istebna", "passat", "dom antka","kaśka/pole", "mcdonald's", "lodowisko"],
    swieta: ["nit mi w tym domu nie pomaga!!!", "piernik", "pieniadze", "mikołaj", "ręka jak młotek", "śnieg?", "mandarynki", "jarmark", "kolendy"],
    filmy: ["Titanic", "Matrix", "star wars", "Avatar", "Hitman", "szybcy i wsciekli", "furioza", "braking bad"],
};

/* ===== PRZYWRACANIE USTAWIEŃ ===== */
window.onload = () => {
    const s = JSON.parse(localStorage.getItem("ustawienia"));
    if (!s) return;

    document.getElementById("gracze").value = s.gracze;
    document.getElementById("trybImpostora").value = s.tryb;

    document.querySelectorAll(".kat").forEach(el => {
        el.checked = s.kategorie.includes(el.value);
    });
};

function start() {
    liczbaGraczy = parseInt(document.getElementById("gracze").value);
    const tryb = document.getElementById("trybImpostora").value;

    const zaznaczone = [...document.querySelectorAll(".kat:checked")].map(e => e.value);
    if (zaznaczone.length === 0) {
        alert("Wybierz przynajmniej jedną kategorię!");
        return;
    }

    /* zapisz ustawienia */
    localStorage.setItem("ustawienia", JSON.stringify({
        gracze: liczbaGraczy,
        tryb: tryb,
        kategorie: zaznaczone
    }));

    /* losowanie hasła BEZ POWTÓRKI */
    let lista = [];
    zaznaczone.forEach(k => lista = lista.concat(kategorie[k]));

    let ostatnie = localStorage.getItem("ostatnieHaslo");
    do {
        slowo = lista[Math.floor(Math.random() * lista.length)];
    } while (lista.length > 1 && slowo === ostatnie);

    localStorage.setItem("ostatnieHaslo", slowo);

    /* impostorzy */
    chaos = false;
    impostorzy = [];

    let ilosc;
    if (tryb === "losowo") {
        const r = Math.random();
        if (r < 0.45) ilosc = 1;
        else if (r < 0.90) ilosc = 2;
        else {
            chaos = true;
            ilosc = liczbaGraczy;
        }
    } else {
        ilosc = parseInt(tryb);
    }

    while (impostorzy.length < ilosc) {
        const i = Math.floor(Math.random() * liczbaGraczy);
        if (!impostorzy.includes(i)) impostorzy.push(i);
    }

    aktualny = 0;
    document.getElementById("start").style.display = "none";
    document.getElementById("gra").style.display = "block";
    pokazInfo();
}

function pokazInfo() {
    document.getElementById("info").innerText = "Gracz " + (aktualny + 1);
    document.getElementById("haslo").innerText = "";
    document.querySelector("button[onclick='dalej()']").style.display = "none";
}

function pokaz() {
    document.getElementById("haslo").innerText =
        (chaos || impostorzy.includes(aktualny)) ? "❌ BRAK HASŁA" : slowo;

    document.querySelector("button[onclick='dalej()']").style.display = "inline";
}

function dalej() {
    aktualny++;
    if (aktualny >= liczbaGraczy) location.reload();
    else pokazInfo();
}
</script>

</body>
</html>
"],
    zawody: ["lekarz", "kucharz", "policjant", "programista", "nauczyciel"],
    filmy: ["Titanic", "Matrix", "Incepcja", "Avatar", "Gladiator"]
};

/* ===== PRZYWRACANIE USTAWIEŃ ===== */
window.onload = () => {
    const s = JSON.parse(localStorage.getItem("ustawienia"));
    if (!s) return;

    document.getElementById("gracze").value = s.gracze;
    document.getElementById("trybImpostora").value = s.tryb;

    document.querySelectorAll(".kat").forEach(el => {
        el.checked = s.kategorie.includes(el.value);
    });
};

function start() {
    liczbaGraczy = parseInt(document.getElementById("gracze").value);
    const tryb = document.getElementById("trybImpostora").value;

    const zaznaczone = [...document.querySelectorAll(".kat:checked")].map(e => e.value);
    if (zaznaczone.length === 0) {
        alert("Wybierz przynajmniej jedną kategorię!");
        return;
    }

    /* zapisz ustawienia */
    localStorage.setItem("ustawienia", JSON.stringify({
        gracze: liczbaGraczy,
        tryb: tryb,
        kategorie: zaznaczone
    }));

    /* losowanie hasła BEZ POWTÓRKI */
    let lista = [];
    zaznaczone.forEach(k => lista = lista.concat(kategorie[k]));

    let ostatnie = localStorage.getItem("ostatnieHaslo");
    do {
        slowo = lista[Math.floor(Math.random() * lista.length)];
    } while (lista.length > 1 && slowo === ostatnie);

    localStorage.setItem("ostatnieHaslo", slowo);

    /* impostorzy */
    chaos = false;
    impostorzy = [];

    let ilosc;
    if (tryb === "losowo") {
        const r = Math.random();
        if (r < 0.45) ilosc = 1;
        else if (r < 0.90) ilosc = 2;
        else {
            chaos = true;
            ilosc = liczbaGraczy;
        }
    } else {
        ilosc = parseInt(tryb);
    }

    while (impostorzy.length < ilosc) {
        const i = Math.floor(Math.random() * liczbaGraczy);
        if (!impostorzy.includes(i)) impostorzy.push(i);
    }

    aktualny = 0;
    document.getElementById("start").style.display = "none";
    document.getElementById("gra").style.display = "block";
    pokazInfo();
}

function pokazInfo() {
    document.getElementById("info").innerText = "Gracz " + (aktualny + 1);
    document.getElementById("haslo").innerText = "";
    document.querySelector("button[onclick='dalej()']").style.display = "none";
}

function pokaz() {
    document.getElementById("haslo").innerText =
        (chaos || impostorzy.includes(aktualny)) ? "❌ BRAK HASŁA" : slowo;

    document.querySelector("button[onclick='dalej()']").style.display = "inline";
}

function dalej() {
    aktualny++;
    if (aktualny >= liczbaGraczy) location.reload();
    else pokazInfo();
}
</script>

</body>
</html>
